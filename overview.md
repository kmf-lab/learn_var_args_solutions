| Pattern | What It Models | What Makes It Special | When to Choose It |
|----------|----------------|-----------------------|-------------------|
| **Enum** | Variants of **data shape** | â€¢ Closed set of wellâ€‘defined options<br>â€¢ Each variant carries its own fields<br>â€¢ Compiler enforces exhaustive handling<br>â€¢ Eliminates invalid combinations | âœ… When the possible kinds are **known ahead of time**<br>âœ… When youâ€™d otherwise use overloaded fns or flag params<br>ğŸ’¡ Great for configuration or â€œmodeâ€ switching |
| **Builder A (Mutable / Owned)** | Stepâ€‘byâ€‘step **object construction** | â€¢ Fluent `.method()` chaining<br>â€¢ Moves `self` (no cloning overhead)<br>â€¢ Natural for oneâ€‘time, mutable creation | âœ… When building a **single object**<br>âœ… When mutability and ownership transfer are fine<br>ğŸ’¡ Feels ergonomic like OOP builders, but memory safe |
| **Builder B (Immutable / Functional)** | Reusable **template configuration** | â€¢ Each setter returns a new cloned builder<br>â€¢ Threadâ€‘safe & pure; great for reuse or loops<br>â€¢ Enables layered configuration | âœ… When you need **reusability or concurrency**<br>âœ… When configs change in loops or tests<br>ğŸ’¡ Strongly declarative, composable style |
| **Trait with `<T: Trait>` (Static Dispatch)** | Compileâ€‘time **behavior abstraction** | â€¢ Zero runtime overhead (monomorphized)<br>â€¢ Strongest type safety; compiler inlines behavior<br>â€¢ Ideal for generic libraries | âœ… When all types are **known at compile time**<br>âœ… When performance, inlining, or constâ€‘generic typing matter<br>ğŸ’¡ â€œGeneric polymorphismâ€ â€” no vtables |
| **Trait with `dyn Trait` (Dynamic Dispatch)** | Runtime **behavior polymorphism** | â€¢ Single interface for heterogenous types<br>â€¢ Enables traitâ€‘object containers (e.g., `Vec<Box<dyn Trait>>`)<br>â€¢ Slight runtime indirection cost | âœ… When behavior is **chosen at runtime**<br>âœ… When mixing unknown implementers (plugâ€‘ins, runtime modules)<br>ğŸ’¡ â€œDynamic polymorphismâ€ â€” flexibility over speed |
| **Hybrid (Enum + Trait)** | Combining **data** and **behavior** variation | â€¢ Enum gives *shape & identity*<br>â€¢ Trait object inside provides extensible *behavior*<br>â€¢ Pattern seen in plugin loaders, game entities, transport stacks | âœ… When both shape and behavior vary<br>âœ… When you need closed categories but open implementations<br>ğŸ’¡ Common in mature systems (**Engine**, **Protocol**, **Plugin** types) |
| **Macro + Builder (Ergonomic Hybrid)** | **Syntactic sugar for typed builder APIs** | â€¢ Macros match argument counts at compile time<br>â€¢ Expand into stronglyâ€‘typed builder calls<br>â€¢ Zero runtime cost, still fully typeâ€‘checked | âœ… When you want **varâ€‘arg feel without varâ€‘args**<br>âœ… When you need an ergonomic DSL or concise API<br>ğŸ’¡ Used throughout the ecosystem (`log!`, `tokio!`, `serde!`) â€” sugar over builder logic |